{{- range $key, $api := .Values.apis }}
{{- if $api.triggeredBy }}
{{- if $api.triggeredBy.trigger }}
{{- range $index, $value := $api.triggeredBy.trigger }}
apiVersion: eventing.knative.dev/v1alpha1
kind: Trigger
metadata:
  name: {{ $key }}-{{ $value }}
  namespace: {{ $.Release.Namespace }}
spec:
  broker: default
  filter:
    sourceAndType:
      type: {{ $value }}
  subscriber:
    ref:
      apiVersion: v1
      kind: Service
      name: {{ $key }}
---
{{- end }}
{{- end }}
{{- if $api.triggeredBy.cron }}
apiVersion: sources.eventing.knative.dev/v1alpha1
kind: CronJobSource
metadata:
  name: {{ $key }}
  namespace: {{ $.Release.Namespace }}
spec:
  schedule: {{ $api.triggeredBy.cron }}
  sink:
    apiVersion: v1
    kind: Service
    name: {{ $key }}
---
{{- end }}
{{- end }}
{{- end }}
